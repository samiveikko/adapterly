{% extends 'core/base.html' %}
{% block content %}
<div class="container py-4">
  <h3>Resources for {{ system.display_name }}</h3>
  <div class="mb-3">
    <a href="{% url 'resource_create' system.id %}" class="btn btn-primary">Add Resource</a>
    <a href="{% url 'interfaces_list' system.id %}" class="btn btn-outline-secondary">Interfaces</a>
  </div>
  <table class="table table-striped">
    <thead>
      <tr><th>Name</th><th>Alias</th><th>Interface</th><th>Description</th><th style="width: 250px;"></th></tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td>{{ it.name }}</td>
        <td><code>{{ it.alias }}</code></td>
        <td><span class="badge bg-light text-dark border">{{ it.interface.name }}</span></td>
        <td class="text-muted small">{{ it.description|default:"" }}</td>
        <td class="text-end">
          <div class="btn-group btn-group-sm">
            <a href="{% url 'actions_list' it.id %}" class="btn btn-outline-secondary" title="View actions">
              <i class="bi bi-list-check"></i> Actions
            </a>
            <a href="{% url 'resource_edit' it.id %}" class="btn btn-outline-primary" title="Edit resource">
              <i class="bi bi-pencil"></i> Edit
            </a>
            <button type="button" class="btn btn-outline-danger" onclick="deleteResource({{ it.id }}, '{{ it.name|escapejs }}')" title="Delete resource">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="text-muted">No resources yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
function deleteResource(id, name) {
  if (!confirm(`Are you sure you want to delete resource "${name}"?\n\nThis will also delete all associated actions.`)) {
    return;
  }
  
  fetch(`/systems/resources/${id}/delete/`, {
    method: 'POST',
    headers: {
      'X-CSRFToken': '{{ csrf_token }}'
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      location.reload();
    } else {
      alert('Error: ' + (data.error || 'Failed to delete'));
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Error deleting resource');
  });
}
</script>
{% endblock %}
