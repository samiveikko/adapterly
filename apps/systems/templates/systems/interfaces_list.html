{% extends 'core/base.html' %}
{% block content %}
<div class="container py-4">
  <h3>Interfaces for {{ system.display_name }}</h3>
  <div class="mb-3">
    <a href="{% url 'interface_create' system.id %}" class="btn btn-primary">Add Interface</a>
    <a href="{% url 'resources_list' system.id %}" class="btn btn-outline-secondary">Resources</a>
  </div>
  <table class="table table-striped">
    <thead>
      <tr><th>Name</th><th>Alias</th><th>Type</th><th>Base URL</th><th style="width: 150px;"></th></tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td>{{ it.name }}</td>
        <td><code>{{ it.alias }}</code></td>
        <td><span class="badge bg-secondary">{{ it.type }}</span></td>
        <td><code class="text-muted small">{{ it.base_url }}</code></td>
        <td class="text-end">
          <div class="btn-group btn-group-sm">
            <a href="{% url 'interface_edit' it.id %}" class="btn btn-outline-primary">
              <i class="bi bi-pencil"></i> Edit
            </a>
            <button type="button" class="btn btn-outline-danger" onclick="deleteInterface({{ it.id }}, '{{ it.name|escapejs }}')">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="text-muted">No interfaces yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
function deleteInterface(id, name) {
  if (!confirm(`Are you sure you want to delete interface "${name}"?\n\nThis will also delete all associated resources and actions.`)) {
    return;
  }
  
  fetch(`/systems/interfaces/${id}/delete/`, {
    method: 'POST',
    headers: {
      'X-CSRFToken': '{{ csrf_token }}'
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      location.reload();
    } else {
      alert('Error: ' + (data.error || 'Failed to delete'));
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Error deleting interface');
  });
}
</script>
{% endblock %}
