{% extends 'core/base.html' %}
{% block content %}
<div class="container py-4">
  <h3>Actions for {{ resource.interface.system.display_name }} / {{ resource.name }} <small class="text-muted">(<code>{{ resource.alias }}</code>)</small></h3>
  <div class="mb-3">
    <a href="{% url 'action_create' resource.id %}" class="btn btn-primary">Add Action</a>
    <a href="{% url 'resources_list' resource.interface.system.id %}" class="btn btn-outline-secondary">Back to Resources</a>
  </div>
  <table class="table table-striped">
    <thead>
      <tr><th>Name</th><th>Alias</th><th>Method</th><th>Path</th><th style="width: 250px;"></th></tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td>{{ it.name }}</td>
        <td><code>{{ it.alias }}</code></td>
        <td><span class="badge bg-secondary">{{ it.method }}</span></td>
        <td><code class="text-muted small">{{ it.path }}</code></td>
        <td class="text-end">
          <div class="btn-group btn-group-sm" role="group">
            <a href="{% url 'test_action' it.id %}" class="btn btn-outline-success" title="Test this action">
              <i class="bi bi-play-circle"></i> Test
            </a>
            <a href="{% url 'action_edit' it.id %}" class="btn btn-outline-primary" title="Edit action">
              <i class="bi bi-pencil"></i> Edit
            </a>
            <button type="button" class="btn btn-outline-danger" onclick="deleteAction({{ it.id }}, '{{ it.name|escapejs }}')" title="Delete action">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="text-muted">No actions yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
function deleteAction(id, name) {
  if (!confirm(`Are you sure you want to delete action "${name}"?`)) {
    return;
  }
  
  fetch(`/systems/actions/${id}/delete/`, {
    method: 'POST',
    headers: {
      'X-CSRFToken': '{{ csrf_token }}'
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      location.reload();
    } else {
      alert('Error: ' + (data.error || 'Failed to delete'));
    }
  })
  .catch(error => {
    console.error('Error:', error);
    alert('Error deleting action');
  });
}
</script>
{% endblock %}
